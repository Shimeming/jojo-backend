= 系統分析
想打球卻臨時缺人？
半夜想吃宵夜卻不知道找誰？
考前想揪人讀書、卻苦等不到戰友？

別擔心！「揪揪 (Jojo)」正是為了解決這些校園生活中的臨時需求而誕生。

本平台面向台灣大學學生，提供使用者發起與參加各類臨時活動（如吃宵夜、運動、讀書、出遊、共煮等）的功能。
透過平台，學生可以快速建立活動、設定人數上限、限定參加範圍（系所、宿舍、社團），並依照個人偏好接收活動推薦。

平台的主要目標是讓學生能在最短時間內找到同好、媒合臨時活動夥伴，並透過智慧推薦機制，減少尋找參與者的時間成本，同時促進校園社群交流。

與一般社群媒體不同的是，「揪揪」不強調長期社群經營，而是聚焦於一次性活動的快速組隊與完成。
每個活動（團）皆為獨立事件，活動結束後系統不保留持續互動關係；
若要再次舉辦，需重新建立新活動，系統將自動指派新的活動編號。

此外，系統特別整合台大校內資源與學生需求，如「二活借教室」、「圖書館討論室預約」功能或「系所限定」、「宿舍限定」的揪團機制。

// 本系統中的「揪團活動」屬於一次性事件，每場活動皆有獨立編號與參與名單。
// 即使活動主題或參與成員相同，只要是不同日期或時間，皆視為新的活動。
// 換言之，「揪團活動」是一個事件而非持續性的群組。

依照不同的功能與權限，本系統的使用者可分為兩種身分：
- 一般使用者（User）\
  台大校內學生為主要使用族群。
  使用者可以：
  - 建立、編輯或刪除自己發起的活動（如宵夜團、讀書團、球賽團等）
  - 加入或退出其他人建立的活動
  - 設定興趣偏好（如「打球」類活動優先推薦）
  - 查詢個人過去參與或舉辦的活動記錄

- 管理者（Admin）\
  系統維運與資料管理者。
  管理者可以：
    - 管理活動分類（新增、刪除、修改活動類型）
    - 管理校內場地（如教室、討論室、球場等可借用資源）
    - 查詢所有使用者的活動紀錄
    - 檢視或刪除違規活動、封鎖可疑使用者
    // - 統計活動使用率與偏好分析，供後續優化

== 系統功能
=== 關於活動的設定
「揪揪」中的每一項活動（Activity）代表一個一次性揪團事件。
使用者在建立活動時，需設定：
- 活動名稱（如：「一起去夜唱！」、「工數期中衝刺團」）
- 活動類型（宵夜、運動、讀書、出遊、共煮、其他）
- 參加人數上限（例如 4 人、10 人）
- 活動時間與地點（可選擇校內教室或自由輸入）
- 活動說明與備註（可填入費用分攤、集合地點等）
- 若活動需要使用校內空間（例如討論室或二活教室），系統會依據「教室可用時段」提供可選時間。
- 校內空間可租借時段以 24 小時制整數顯示，目前設定為 08:00–21:00；每次租借單位為 1 小時，連續最多可預約 3 小時。
例如：
若使用者欲舉辦一場「期中衝刺團」，選擇日期 2025/10/30、場地「二活 303」，系統顯示可借用時段為 13、14、15、17、18。
則可選擇預約連續的 13–15 時段（共 3 小時） 或 17–18 時段（共 2 小時）。 // ，但不可選擇不連續的 15 與 17

=== 給使用者（User）的功能
- 建立活動（新增揪團）
    - 輸入活動內容（名稱、說明、類型）
    - 設定日期、時間、地點
    - 選擇活動限定的對象、人數上限
    - 系統將活動新增至資料庫，自動生成唯一活動編號，並推薦給合適的對象
- 查詢活動
  - 可查詢自己建立的活動（進行中 / 已結束）
  - 可查詢自己參加過的活動（進行中 / 已結束）
  - 可查詢目前平台上可參加的公開活動
- 加入活動
  - 點擊欲參與的活動，系統新增一筆報名資料至資料庫
  - 若人數已滿，系統會提示或加入候補名單
- 退出活動
  - 若使用者臨時無法參加，可取消已報名但尚未開始的活動
  - 系統將自動釋出名額
- 設定偏好與活動推薦
  - 使用者可設定感興趣的活動類型
  - 系統依據偏好主動推播相關活動（例如「打球」活動優先推薦）
  - 可選擇「自動報名」功能（系統在符合條件時自動加入）
- 註冊、刪除帳號

=== 給管理者（Admin）的功能
- 管理活動類型
  - 新增、修改或刪除平台上活動分類（如新增「系所聚餐」類別）
- 管理場地資訊
  - 維護可借用場地資料（教室名稱、可借時段、容量等）
  - 更新場地狀態（維修中、暫停使用等）
- 使用者活動紀錄查詢
  - 查詢任一使用者發起與參與過的活動清單
  - 可查看活動詳細內容、參與名單與舉辦次數統計
- 活動監控與維護
  - 檢視所有活動狀態
  - 對違規、重複或惡意活動進行刪除
  - 封鎖違規使用者或回報異常行為

= 系統設計
== ER Diagram
#figure(
  [#include "er-diagram.typ"],
  caption: [「揪揪」的 ER Diagram],
) <fig:er-diagram>
@fig:er-diagram 為「揪揪（JoJo）」的 ER Diagram。在這個 ERD 中共有五個實體（entity），分別是
USER、EVENT、VENUE、GROUP、PREFERENCE_TYPE，以及七個關係（relationship）。


=== 實體
- USER：代表使用「揪揪」平台的所有人，使用者必須註冊後才能建立或參與活動。註冊時須提供姓名、學號、校內信箱與密碼，系統會為其建立一組唯一識別碼。經由後台設定，特定使用者可同時具備 Admin 權限。
- EVENT：代表一個揪團活動。使用者可以建立（發起）多場活動或參與他人建立的活動。每場活動包含標題、內容、參加人數上限、地點、開始與結束時間等屬性。活動可以使用需要預約的場地，系統會協助預約。活動可為公開或限定群組（例如系所限定或宿舍限定）。
- VENUE：代表需要預約的校內場地。可為校內教室、討論室、運動場地。系統記錄場地名稱。
- GROUP：代表系統中可作為限定條件的群組，如「資工系」、「男一舍」或「登山社」。使用者可隸屬多個群組。
- PREFERENCE_TYPE：代表活動類型，考慮了台大生可能會想一次性揪人的活動，如「運動」、「出遊」、「共煮」、「宵夜」、「讀書」、「練舞」、「其他」。


使用者可以建立活動，也可以參加他人建立的活動，如果該活動有限定某群組成員參加，則該使用者必須屬於該群組才能參加活動。若活動人數已達上限，也會被拒絕參加。使用者可以同時參與多個活動，也可以屬於多個群組。

當使用者建立活動時，使用者需要填寫該活動的名稱、內容、活動類型、限定群組、人數以及起始結束時間，然後使用者需要填寫活動場地，如果活動場地屬於需要特別借用的類型(如二活教室、圖書館討論室等)，系統協助預定，列出該時段可用的場地。活動成立則代表該場地於該時段已被借用，之後的使用者在查詢時便會被告知該時段場地已被借用。最後，使用者需要決定該活動是否專屬特定群組，如特定宿舍生、特定系所或社團，也可以設定為公開活動，即不限定成員身分。

使用者在使用該系統時，可以透過推薦按鈕得知最近自己可能感興趣的活動。系統會依據使用者先前編輯的偏好活動類型推薦近期的活動，使用者可以依據自己的時間安排選擇想參加的活動。


== Relational Database Schema Diagram
#figure(
  [#include "schema.typ"],
  caption: [「揪揪」的 Relational Database Schema Diagram],
) <fig:schema>
由 ER Diagram 可轉換成圖 2 的資料庫關聯模型，共有 十個主要資料表（Relation），分別為：
`USER、ADMIN_USER、USER_GROUP、EVENT、JOIN_RECORD、VENUE、GROUP、PREFERENCE、EVENT_TYPE`。

以下分別說明其主鍵（PK）、外鍵（FK）與關聯性。

- `USER`
  - 主鍵（PK）：User_id
  - 屬性：Name, Email, Sex, Password, Phone, Register_time
  - 說明：儲存所有使用者基本資料。Email 必須為台大信箱（以驗證校內身分）。
- `ADMIN_USER`
  - 主鍵（PK）：User_id
  - 外鍵（FK）：User_id → USER(User_id)
  - 說明：因為 admin 數量較少，而且默認 admin 也屬於使用者，因此獨立出一個表紀錄。
- `USER_GROUP`
  - 主鍵（PK）：User_id, Group_id
  - 外鍵（FK）：User_id → USER(User_id)
  - 外鍵（FK）：Group_id → GROUP(Group_id)
  - 說明：由於使用者可同時參與多個群組，因此將群組設為多值屬性拆出獨立表。
- `EVENT`
  - 主鍵（PK）：Event_id
  - 外鍵（FK）：Owner_id → USER(User_id)
  - 外鍵（FK）：Group_id → GROUP(Group_id)（可為 NULL，若活動為公開）
  - 外鍵（FK）：Type_name → EVENT_TYPE(name)
  - 屬性：Title, Content, Capacity, Location_desc, Start_time, End_time, Status, Created_at
  - 說明：儲存每場揪團活動的核心資訊，包含主辦人、活動時段、人數上限、限定群組等。
- `JOIN_RECORD`
  - 主鍵（PK）：Event_id, User_id
  - 外鍵（FK）：Event_id → EVENT(Event_id)
  - 外鍵（FK）：User_id → USER(User_id)
  - 屬性：Join_time, Status (confirmed / rejected / cancelled)
  - 說明：代表使用者與活動間的多對多關係，用於記錄報名與參加狀態。
- `VENUE`
  - 主鍵（PK）：Venue_id
  - 屬性：Name, Building, Location
  - 說明：儲存教室、球場或其他可借場地的資訊，供活動建立時查詢。
- `GROUP`
  - 主鍵（PK）：Group_id
  - 屬性：Name, Category
  - 說明：代表系所、宿舍或社團。活動若設定為群組限定，僅該群組成員可加入。
- `PREFERENCE`
  - 主鍵（PK）：User_id, Type_name
  - 外鍵（FK）：User_id → USER(User_id)
  - 外鍵（FK）：Type_name → EVENT_TYPE(name)
  - 說明：使用者的偏好設定表，用於推薦使用者可能想參加的活動
- `EVENT_TYPE`
  - 主鍵（PK）：name
  - 說明：所有可能的活動類別

#pagebreak()
== Data Dictionary
#include "data-dictionary.typ"

== 正規化分析
此「揪揪(JOJO)」系統的料庫關聯模型經過設計，旨在最小化資料冗餘並確保資料一致性。以下我們將會分析其正規化的程度：
=== 第一正規化(1NF)
定義：確保資料表中所有欄位(屬性)都是不可分割的(atomic)，且每一筆資料都有一個唯一的主鍵(PK)。

- 主鍵 : 所有的資料表(`USER`, `ADMIN_USER`, `GROUP`, `EVENT_TYPE`, `USER_GROUP`, `EVENT`, `JOIN_RECORD`, `VENUE`, `PREFERENCE`) 都已定義了主鍵(PK)。
- 原子性 : 根據Data Dictionary，所有欄位均為原子值。例如，沒有一個欄位會同時儲存多個號碼或群組。
- 多值屬性 : 設計中正確地處理了多值屬性與多對多關係。例如:
  - `USER` 與 `GROUP` 之間的多對多關係，被分解為一個獨立的 `USER_GROUP` 關聯資料表。
  - `USER` 與 `EVENT` 之間「參加（`JOIN`）」多對多關係，被分解為 `JOIN_RECORD` 。
  - `USER` 與 `PREFERENCE_TYPE` 的多重偏好，被分解為 `PREFERENCE` 資料表。
故此資料庫符合第一正規化(1NF)


=== 第二正規化(2NF)
定義：必須先答合1NF，此外非主鍵(non-key)屬性必須完全功能相依於整個主鍵。此規則主要檢視具有複合主鍵(Composite PK)的資料表。

此結構中具有複合主鍵的資料表為(`USER_GROUP, JOIN_RECORD和 PREFERENCE`) 。
- `USER_GROUP` :
  - 主鍵(PK) : `User_id`, `Group_id`
  - 非主鍵屬性 : 無
  - 結論 : 由於沒有非主鍵屬性，因此自動符合2NF 
-  `JOIN_RECORD` :
  - 主鍵(PK) : `Event_id`, `User_id`
  - 非主鍵屬性 : `Join_time`, `Status`
  - `Join_time`和`Status`都必須同時依於於哪個使用者(`User_id`)和哪個活動(`Event_id`)才能確定。它們不依賴於主鍵的任何一部分。
  - 結論 : 符合2NF 
-  `PREFERENCE` :
  - 主鍵(PK) : `User_id`
  - 非主鍵屬性 : `TYPE_name`
  - `Type_name`(偏好類別)必須同時依賴於哪個使用者(`User_id`)才能確定。
  - 結論 : 符合2NF 
對於所有單一欄位主鍵的資料表 (如 USER, EVENT, VENUE 等)，它們自動符合 2NF。
故此資料庫結構符合第二正規化 (2NF)。

=== 第三正規化(3NF)
定義：必須先符合 2NF。此外，所有非主鍵屬性都不能「遞移相依」(Transitive Dependency) 於主鍵。這意味著非主鍵屬性之間不能有相依關係 (即非主鍵屬性不能相依於另一個非主鍵屬性)。

我們檢視所有資料表，確保沒有非主鍵屬性可由另一個非主鍵屬性推導出來。
- `USER` 資料表：
   屬性 `Name`, `Email`, `Sex`, `Phone` 等皆直接相依於 `User_id`。`Email` 並不決定 `Phone`，`Name` 也不決定 `Sex`。
- `EVENT` 資料表：
   屬性 `Title`, `Content`, `Capacity`, `Start_time` 等皆直接相依於 `Event_id`。`Title` (標題) 並不決定 `Capacity` (人數上限)。
- `VENUE` 資料表：
   屬性 `Name`, `Building`, `Floor`, `Capacity`, `Open_time` 等皆直接相依於 `Venue_id`。`Building` (建築物) 並不能唯一決定 `Capacity` (容量) 或 `Open_time` (開放時間)，這些屬性皆直接隸屬於 `Venue_id`。
經檢視，所有資料表中的非主鍵屬性都僅直接相依於其主鍵，並不存在遞移相依。
故此資料庫結構符合第三正規化 (3NF)。

=== Boyce-Codd 正規化 (BCNF)
定義：必須符合3NF。此名，對於每一個非平凡的功能相依 X $->$ Y， X 都必須是一個超鍵(Superkey)。

我們檢視所有資料表中的功能相依，確認其決定因子 (Determinant, X) 皆為超鍵。 
- `USER` 資料表：
  `User_id` 是主鍵 (超鍵)。Data Dictionary 中`Email` 和 `Phone` 欄位皆有 `Unique` 約束，因此它們也是候選鍵 (Candidate Keys)，故亦為超鍵。此表中所有功能相依的決定因子都是超鍵。
- `GROUP` 資料表：
  `Group_id` 是主鍵 (超鍵)。`Name` 欄位有 `Unique` 約束，所以也是超鍵。
- `EVENT_TYPE` 資料表：`name` 是主鍵 (超鍵)，亦有 `Unique` 約束。
- `PREFERENCE` 資料表：
  唯一的功能相依是 (`User_id`)$->$`Type_name`。其決定因子是主鍵，故也是超鍵。
- `JOIN_RECORD` 資料表：
  唯一的功能相依是 (`Event_id`, `User_id`)$->$(`Join_time`, `Status`)。其決定因子是主鍵，故也是超鍵。
- 其他資料表：功能相依都由主鍵決定，因此決定因子都是超鍵。 
故此資料庫結構符合 BCNF。
這確保了資料的完整性，並最大限度地減少了資料更新、插入或刪除時可能出現的異常。

=== 第四正規化(4NF)
定義 : 必須先符合BCNF，此外資料表中不能存在任非平凡的多值相依(Multivalued Dependency MVD)。4NF主要處理的是一個資料表中不能包含兩個或多個獨立的多對多關係。

此資料庫結構已符合BCNF。我們現在檢視是否存在多值相依。多值相依　X$->$Y意味著X的一個值對應到一組Y值，且這組Y值立於資料表中的甚他屬性。

此結構已將所有多對多(M:N)關係分解為獨立的關聯資料表
- `USER_GROUP`： 僅儲存 `USER` 和 `GROUP` 之間的 M:N 關係。它不包含任何其他獨立於此關係的屬性
- `JOIN_RECORD`： 僅儲存 `USER` 和 `EVENT` 之間的 M:N 關係。`Join_time`和`Status`皆相依於`Event_id` 和 `User_id` ，而非獨立的多值事實。
- `PREFERENCE`： 僅儲存 `USER` 和 `EVENT_TYPE` 之間的M:N關係。
設計中沒有任何資料表試圖同時儲存兩種不相關的多值事實。例如，`USER`資料表並未試圖同時儲存「使用者屬所有群組」和「使用者偏好的所有活動類型」。這些關係都有被正確地分離到`USER_GROUP`和`PREFERENCE`表中。故符合第四正規化(4NF)。
